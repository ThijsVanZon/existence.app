<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2015-2025</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
  <a href="{{ url_for('index') }}"><h1>Timeline</h1></a>
  <nav class="timeline" aria-label="enlightenment timeline">
    <div class="sub-decade-container" id="decade-2015">
      <span class="sub-decade" id="sub-decade-2015">2015</span>
    </div>
    <div class="main-decade-container" id="decade-2020">
      <span class="main-decade" id="main-decade-2020">ENLIGHTENMENT</span>
    </div>
    <div class="sub-decade-container" id="decade-2025">
      <span class="sub-decade" id="sub-decade-2025">2025</span>
    </div>
  </nav>

  <h2>Scraped Jobs</h2>
  <button onclick="startScraping()">Scrape Jobs</button>

  <p id="status" aria-live="polite"></p>
  <div id="results"></div>
  <div id="error" class="error" style="display: none;"></div>

  <script>
    function createJobResult(job) {
      const row = document.createElement('p');

      const title = document.createElement('strong');
      title.textContent = `Title: ${job.title || 'Unknown'}`;
      row.appendChild(title);

      const details = document.createElement('span');
      details.textContent = `, Company: ${job.company || 'Unknown'}, Location: ${job.location || 'Unknown'}, Link: `;
      row.appendChild(details);

      const link = document.createElement('a');
      link.href = job.link || '#';
      link.textContent = 'Job Link';
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      row.appendChild(link);

      return row;
    }

    function startScraping() {
      const resultsDiv = document.getElementById('results');
      const errorDiv = document.getElementById('error');
      const status = document.getElementById('status');

      resultsDiv.innerHTML = '';
      errorDiv.style.display = 'none';
      status.textContent = 'Scraping jobs... this may take a moment.';

      fetch('/scrape')
        .then(response => {
          if (!response.ok) {
            return response.json().then(payload => {
              throw new Error(payload.error || 'Network response was not ok');
            });
          }
          return response.json();
        })
        .then(data => {
          status.textContent = `Finished scraping. Found ${data.length} jobs.`;
          if (!data.length) {
            resultsDiv.textContent = 'No jobs were found this time. Try again later.';
            return;
          }

          data.forEach(job => {
            resultsDiv.appendChild(createJobResult(job));
          });
        })
        .catch(error => {
          status.textContent = '';
          errorDiv.textContent = `An error occurred while scraping jobs: ${error.message}`;
          errorDiv.style.display = 'block';
        });
    }
  </script>

  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>
